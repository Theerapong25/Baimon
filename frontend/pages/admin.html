<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Cafe Management</title>

  <!-- Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --pink: #f28ab2;
      --pink-600: #e0548a;
      --pink-50: #fde6ef;
      --ink: #2c2c2c;
      --muted: #737373;
      --card: #fff;
      --line: #f4dbe6;
      --radius: 16px;
      --sbw: 260px;
      /* sidebar width (grid col 1) */
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: 'Inter', 'Noto Sans Thai', system-ui, Segoe UI, Arial, sans-serif;
      background: var(--pink-50);
      color: var(--ink);
    }

    /* ====== APP GRID ====== */
    .app {
      display: grid;
      grid-template-columns: var(--sbw) 1fr;
      grid-template-rows: 1fr;
      min-height: 100vh;
      transition: grid-template-columns .25s ease;
    }

    .app.collapsed {
      --sbw: 84px;
    }

    /* ====== SIDEBAR ====== */
    .sidebar {
      background: var(--pink);
      color: #fff;
      padding: 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      border-right: 1px solid rgba(255, 255, 255, .25);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px 14px;
      border-bottom: 1px solid rgba(255, 255, 255, .35);
      margin-bottom: 6px;
      font-weight: 700;
    }

    .brand .bubble {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      background: #fff2f7;
      color: var(--pink-600);
      font-size: 18px;
    }

    .menu {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    .menu li {
      border-radius: 12px;
      padding: 10px 12px;
      display: grid;
      grid-template-columns: 24px 1fr;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .menu li:hover {
      background: rgba(255, 255, 255, .13);
    }

    .menu li.active {
      background: rgba(255, 255, 255, .25);
    }

    .menu .label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ‡∏ã‡πà‡∏≠‡∏ô label ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏±‡∏ö */
    .app.collapsed .menu .label {
      display: none;
    }

    .app.collapsed .brand .text {
      display: none;
    }

    /* ====== MAIN ====== */
    .main {
      display: flex;
      flex-direction: column;
      min-width: 0;
      /* ‡∏Å‡∏±‡∏ô overflow */
    }

    /* topbar ‡∏ï‡∏¥‡∏î‡∏ö‡∏ô */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 3;
      background: linear-gradient(180deg, #fff, rgba(255, 255, 255, .8));
      
      border-bottom: 1px solid var(--line);
      padding: 12px 18px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle {
      border: none;
      border-radius: 10px;
      background: var(--pink);
      color: #fff;
      padding: 8px 10px;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 6px 14px rgba(242, 138, 178, .22);
    }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
      font-weight: 700;
      color: #1e1e1e;
    }

    .title .emoji {
      font-size: 22px
    }

    .content {
      padding: 22px;
      display: block;
      min-width: 0;
    }

    /* ====== PAGES ====== */
    .page {
      display: none;
      animation: fade .18s ease;
    }

    .page.active {
      display: block;
    }

    @keyframes fade {
      from {
        opacity: 0;
        transform: translateY(6px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    /* ====== CARDS ====== */
    .stats {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(3, minmax(240px, 1fr));
    }

    @media (max-width:1024px) {
      .stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width:640px) {
      .stats {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: 0 10px 28px rgba(0, 0, 0, .05);
    }

    .card h3 {
      margin: 0 0 8px;
      font-weight: 600;
      color: #6b6b6b;
    }

    .card .big {
      font-size: 34px;
      color: var(--pink-600);
      font-weight: 800;
    }

    /* ====== TABLE ====== */
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .05);
    }

    th,
    td {
      padding: 12px 14px;
      border-bottom: 1px solid var(--line);
      text-align: left;
    }

    th {
      background: #fff;
    }

    tr:hover td {
      background: #fff7fb;
    }

    .btn {
      background: var(--pink);
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(242, 138, 178, .22);
    }

    .btn:hover {
      background: var(--pink-600);
    }

    .actions button {
      background: var(--pink);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      margin-right: 6px;
      cursor: pointer;
    }

    .actions button:hover {
      background: var(--pink-600);
    }

    /* ====== MODAL ====== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .45);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 10;
    }

    .modal.open {
      display: flex;
    }

    .sheet {
      width: min(520px, 92vw);
      background: #fff;
      border-radius: 16px;
      padding: 18px 18px 20px;
      box-shadow: 0 16px 40px rgba(0, 0, 0, .2);
    }

    .sheet h3 {
      margin: 0 0 10px;
    }

    .field {
      margin: 10px 0;
    }

    .field label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .field input,
    .field select {
      width: 100%;
      padding: 12px 12px;
      border: 1px solid var(--line);
      border-radius: 10px;
      font-family: inherit;
    }

    .preview {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .preview img {
      width: 86px;
      height: 86px;
      border-radius: 10px;
      object-fit: cover;
      border: 1px solid #e9e9e9;
    }

    /* motion safe */
    @media (prefers-reduced-motion:reduce) {
      .app {
        transition: none
      }

      .page {
        animation: none
      }
    }
  </style>
</head>

<body>

  <div class="app" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="bubble">‚òï</div>
        <div class="text">Admin</div>
      </div>
      <ul class="menu" id="menu">
        <li class="active" data-page="dashboard"><span>üìä</span><span class="label">Dashboard</span></li>
        <li data-page="cafes"><span>üè™</span><span class="label">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</span></li>
        <li data-page="menus"><span>üçΩÔ∏è</span><span class="label">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</span></li>
        <li data-page="reviews"><span>üí¨</span><span class="label">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</span></li>
      </ul>
    </aside>

    <!-- MAIN -->
    <section class="main">
      <div class="topbar">
        <button class="toggle" id="toggle">‚ò∞</button>
        <div class="title"><span class="emoji">üìä</span><span id="pageTitle">Dashboard</span></div>
      </div>

      <div class="content">

        <!-- PAGE: Dashboard -->
        <div class="page active" id="dashboard">
          <div class="stats">
            <div class="card">
              <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
              <div class="big">10</div>
            </div>
            <div class="card">
              <h3>‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
              <div class="big">45</div>
            </div>
            <div class="card">
              <h3>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
              <div class="big">98</div>
            </div>
          </div>
        </div>

        <!-- PAGE: Cafes -->
        <div class="page" id="cafes">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <h2 style="margin:0">üè™ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</h2>
            <button class="btn" id="addCafe">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</button>
          </div>

          <table>
            <thead>
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</th>
                <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î</th>
                <th>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="cafeTable">
              <tr>
                <td>Charista Home</td>
                <td><a href="#" target="_blank">‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a></td>
                <td>08:00‚Äì18:00</td>
                <td>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</td>
                <td class="actions"><button>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button>‡∏•‡∏ö</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- PAGE: Menus -->
        <div class="page" id="menus">
          <h2 style="margin-top:0">üçΩÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π</h2>
          <div class="field" style="max-width:320px">
            <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏°‡∏ô‡∏π</label>
            <select id="menuType">
              <option>‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
              <option>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
              <option>‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô</option>
            </select>
          </div>
          <button class="btn" id="addMenu">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
          <table>
            <thead>
              <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="menuTable">
              <tr>
                <td>‡∏•‡∏≤‡πÄ‡∏ï‡πâ‡πÄ‡∏¢‡πá‡∏ô</td>
                <td>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</td>
                <td>65</td>
                <td class="actions"><button>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button><button>‡∏•‡∏ö</button></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- PAGE: Reviews -->
        <div class="page" id="reviews">
          <h2 style="margin-top:0">üí¨ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h2>
          <table>
            <thead>
              <tr>
                <th>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                <th>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</th>
                <th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th>
                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Praew</td>
                <td>‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏µ</td>
                <td>5‚≠ê</td>
                <td class="actions"><button>‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö</button><button>‡∏•‡∏ö</button></td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </section>
  </div>

  <!-- MODAL: Add Cafe -->
  <div class="modal" id="cafeModal">
    <div class="sheet">
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡πÉ‡∏´‡∏°‡πà</h3>
      <div class="field"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà</label><input id="cafeName" /></div>
      <div class="field"><label>‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps</label><input id="cafeMap" placeholder="https://goo.gl/maps/..." />
      </div>
      <div class="field"><label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‚Äì‡∏õ‡∏¥‡∏î</label><input id="cafeTime" placeholder="08:00‚Äì18:00" /></div>
      <div class="field"><label>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</label><input id="cafeClose" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå" /></div>
      <div class="field">
        <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</label>
        <input type="file" id="cafeImages" multiple accept="image/*" />
        <div class="preview" id="preview"></div>
      </div>
      <div class="field">
        <label>‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏°‡πÄ‡∏î‡∏• 3D (.glb/.gltf)</label>
        <input type="file" id="cafeModel" accept=".glb,.gltf" />
        <small style="color:var(--muted)">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏°‡πÄ‡∏î‡∏• 3D ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</small>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="saveCafe">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn" style="background:#e6e6e6;color:#222" id="closeCafe">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>
  </div>

  <script>
     const menuItems = document.querySelectorAll("#menu li");
  const pages = document.querySelectorAll(".page");
  const pageTitle = document.getElementById("pageTitle");

  menuItems.forEach(item => {
    item.addEventListener("click", () => {
      // 1Ô∏è‚É£ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô active ‡∏Ç‡∏≠‡∏á menu
      menuItems.forEach(i => i.classList.remove("active"));
      item.classList.add("active");

      // 2Ô∏è‚É£ ‡πÅ‡∏™‡∏î‡∏á page ‡∏ï‡∏≤‡∏° data-page
      const target = item.getAttribute("data-page");
      pages.forEach(p => p.classList.remove("active"));
      document.getElementById(target).classList.add("active");

      // 3Ô∏è‚É£ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ topbar
      const label = item.querySelector(".label").textContent;
      pageTitle.textContent = label;
    });
  });

  // ===== toggle sidebar =====
  const app = document.getElementById("app");
  const toggle = document.getElementById("toggle");
  toggle.addEventListener("click", () => {
    app.classList.toggle("collapsed");
  });
    
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
    (async () => {
      try {
        const res = await fetch("http://localhost:5001/auth/me", {
          headers: { Authorization: "Bearer " + token },
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.message || "unauthorized");

        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤
        if (data.role !== "admin") {
          alert("‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
          localStorage.removeItem("token");
          window.location.href = "login.html";
        }

        console.log("‚úÖ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ADMIN:", data.name);
      } catch (err) {
        console.error(err);
        localStorage.removeItem("token");
       // window.location.href = "admin.html";
      }
    })();

  </script>
</body>

</html>